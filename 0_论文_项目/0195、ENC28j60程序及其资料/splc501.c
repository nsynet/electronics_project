#include "splc501.h"
#include "mcu_uart.h"

void delay()
{
	_nop_();_nop_();_nop_();_nop_();_nop_();
}

code unsigned char lv[]={
        0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00, // - -
        0x00,0x00,0x00,0x7C,0x00,0x00,0x00,0x00,0x00,0x80,0x00,0x00, // -!-
        0x00,0x70,0x40,0x00,0x70,0x40,0x00,0x00,0x00,0x00,0x00,0x00, // -"-
        0x00,0x0A,0x1F,0x6A,0x1F,0x6A,0x00,0xC0,0x00,0xC0,0x00,0x00, // -#-
        0x00,0x1B,0x25,0x65,0x26,0x00,0x00,0x00,0x00,0xC0,0x00,0x00, // -$-
        0x00,0x24,0x54,0x25,0x0A,0x09,0x00,0x00,0x00,0x00,0x80,0x00, // -%-
        0x00,0x03,0x0C,0x12,0x11,0x02,0x00,0x00,0x80,0x80,0x00,0x80, // -&-
        0x00,0x00,0x00,0x78,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00, // -'-
        0x00,0x00,0x00,0x1F,0x60,0x00,0x00,0x00,0x00,0x80,0x60,0x00, // -(-
        0x00,0x00,0x60,0x1F,0x00,0x00,0x00,0x00,0x60,0x80,0x00,0x00, // -)-
        0x00,0x20,0x2C,0x70,0x2C,0x20,0x00,0x00,0x00,0x00,0x00,0x00, // -*-
        0x04,0x04,0x04,0x3F,0x04,0x04,0x00,0x00,0x00,0x80,0x00,0x00, // -+-
        0x00,0x00,0x00,0x01,0x01,0x00,0x00,0x00,0x60,0xC0,0x00,0x00, // -,-
        0x00,0x04,0x04,0x04,0x04,0x04,0x00,0x00,0x00,0x00,0x00,0x00, // ---
        0x00,0x00,0x01,0x01,0x00,0x00,0x00,0x00,0x80,0x80,0x00,0x00, // -.-
        0x00,0x00,0x01,0x06,0x18,0x60,0x00,0x40,0x80,0x00,0x00,0x00, // -/-
        0x00,0x3F,0x40,0x40,0x40,0x3F,0x00,0x00,0x80,0x80,0x80,0x00, // -0-
        0x00,0x00,0x40,0x7F,0x00,0x00,0x00,0x80,0x80,0x80,0x80,0x80, // -1-
        0x00,0x21,0x42,0x44,0x48,0x31,0x00,0x80,0x80,0x80,0x80,0x80, // -2-
        0x00,0x21,0x40,0x48,0x48,0x37,0x00,0x00,0x80,0x80,0x80,0x00, // -3-
        0x00,0x06,0x0A,0x32,0x42,0x7F,0x00,0x00,0x00,0x00,0x80,0x80, // -4-
        0x00,0x01,0x78,0x48,0x48,0x47,0x00,0x00,0x80,0x80,0x80,0x00, // -5-
        0x00,0x1F,0x28,0x48,0x48,0x47,0x00,0x00,0x80,0x80,0x80,0x00, // -6-
        0x00,0x60,0x40,0x41,0x4E,0x70,0x00,0x00,0x00,0x80,0x00,0x00, // -7-
        0x00,0x37,0x48,0x48,0x48,0x37,0x00,0x00,0x80,0x80,0x80,0x00, // -8-
        0x00,0x38,0x44,0x44,0x45,0x3E,0x00,0x80,0x80,0x80,0x00,0x00, // -9-
        0x00,0x00,0x19,0x19,0x00,0x00,0x00,0x00,0x80,0x80,0x00,0x00, // -:-
        0x00,0x00,0x00,0x19,0x19,0x00,0x00,0x00,0xC0,0x80,0x00,0x00, // -;-
        0x04,0x0A,0x0A,0x11,0x20,0x20,0x00,0x00,0x00,0x00,0x80,0x80, // -<-
        0x00,0x0A,0x0A,0x0A,0x0A,0x0A,0x00,0x00,0x00,0x00,0x00,0x00, // -=-
        0x20,0x20,0x11,0x0A,0x0A,0x04,0x80,0x80,0x00,0x00,0x00,0x00, // ->-
        0x00,0x00,0x10,0x22,0x24,0x18,0x00,0x00,0x80,0x80,0x00,0x00, // -?-
        0x00,0x7F,0x80,0x8C,0x92,0x7E,0x00,0x80,0x40,0x40,0x40,0x80, // -@-
        0x00,0x03,0x5E,0x62,0x1E,0x03,0x80,0x80,0x80,0x00,0x80,0x80, // -A-
        0x40,0x7F,0x48,0x48,0x48,0x37,0x80,0x80,0x80,0x80,0x80,0x00, // -B-
        0x00,0x3F,0x40,0x40,0x40,0x61,0x00,0x00,0x80,0x80,0x80,0x00, // -C-
        0x40,0x7F,0x40,0x40,0x21,0x1E,0x80,0x80,0x80,0x80,0x00,0x00, // -D-
        0x40,0x7F,0x48,0x5C,0x40,0x61,0x80,0x80,0x80,0x80,0x80,0x80, // -E-
        0x00,0x40,0x7F,0x48,0x5C,0x40,0x00,0x80,0x80,0x80,0x00,0x00, // -F-
        0x00,0x3F,0x40,0x40,0x44,0x67,0x00,0x00,0x80,0x80,0x80,0x00, // -G-
        0x40,0x7F,0x48,0x08,0x48,0x7F,0x80,0x80,0x80,0x00,0x80,0x80, // -H-
        0x00,0x40,0x40,0x7F,0x40,0x40,0x00,0x80,0x80,0x80,0x80,0x80, // -I-
        0x00,0x07,0x40,0x40,0x7F,0x40,0x00,0x00,0x80,0x80,0x00,0x00, // -J-
        0x40,0x7F,0x44,0x0C,0x52,0x61,0x80,0x80,0x80,0x00,0x00,0x80, // -K-
        0x00,0x40,0x7F,0x40,0x00,0x03,0x00,0x80,0x80,0x80,0x80,0x80, // -L-
        0x40,0x7F,0x70,0x0C,0x70,0x7F,0x80,0x80,0x80,0x00,0x80,0x80, // -M-
        0x40,0x7F,0x70,0x0E,0x41,0x7F,0x80,0x80,0x80,0x00,0x80,0x80, // -N-
        0x00,0x3F,0x40,0x40,0x40,0x3F,0x00,0x00,0x80,0x80,0x80,0x00, // -O-
        0x00,0x40,0x7F,0x44,0x44,0x38,0x00,0x80,0x80,0x80,0x00,0x00, // -P-
        0x00,0x3F,0x40,0x40,0x40,0x3F,0x00,0x00,0x80,0xC0,0xC0,0x40, // -Q-
        0x40,0x7F,0x44,0x44,0x46,0x39,0x80,0x80,0x80,0x00,0x00,0x00, // -R-
        0x00,0x31,0x49,0x48,0x28,0x67,0x00,0x80,0x00,0x80,0x80,0x00, // -S-
        0x60,0x40,0x40,0x7F,0x40,0x40,0x00,0x00,0x80,0x80,0x80,0x00, // -T-
        0x40,0x7F,0x40,0x00,0x40,0x7F,0x00,0x00,0x80,0x80,0x80,0x00, // -U-
        0x40,0x70,0x4E,0x01,0x4E,0x70,0x00,0x00,0x00,0x80,0x00,0x00, // -V-
        0x40,0x7F,0x40,0x0F,0x40,0x7F,0x00,0x00,0x80,0x00,0x80,0x00, // -W-
        0x40,0x61,0x12,0x0C,0x12,0x61,0x80,0x80,0x00,0x00,0x00,0x80, // -X-
        0x40,0x60,0x58,0x07,0x58,0x60,0x00,0x00,0x80,0x80,0x80,0x00, // -Y-
        0x00,0x61,0x42,0x4C,0x50,0x61,0x00,0x80,0x80,0x80,0x80,0x80, // -Z-
        0x00,0x00,0x7F,0x40,0x40,0x00,0x00,0x00,0xE0,0x20,0x20,0x00, // -[-
        0x00,0x40,0x38,0x06,0x01,0x00,0x00,0x00,0x00,0x00,0xC0,0x00, // -\-
        0x00,0x00,0x40,0x40,0x7F,0x00,0x00,0x00,0x20,0x20,0xE0,0x00, // -]-
        0x00,0x08,0x10,0x60,0x10,0x08,0x00,0x00,0x00,0x00,0x00,0x00, // -^-
    	0x00,0x00,0x00,0x00,0x00,0x00,0x10,0x10,0x10,0x10,0x10,0x10, // -_-
    	0x00,0x00,0x00,0x40,0x20,0x00,0x00,0x00,0x00,0x00,0x00,0x00, // -`-
        0x00,0x0B,0x14,0x14,0x14,0x0F,0x00,0x00,0x80,0x80,0x80,0x80, // -a-
        0x40,0x7F,0x08,0x10,0x10,0x0F,0x80,0x80,0x80,0x80,0x80,0x00, // -b-
        0x00,0x0F,0x10,0x10,0x10,0x19,0x00,0x00,0x80,0x80,0x80,0x00, // -c-
        0x00,0x0F,0x10,0x10,0x48,0x7F,0x00,0x00,0x80,0x80,0x80,0x80, // -d-
        0x00,0x0F,0x14,0x14,0x14,0x0C,0x00,0x00,0x80,0x80,0x80,0x80, // -e-
        0x00,0x10,0x3F,0x50,0x50,0x50,0x00,0x80,0x80,0x80,0x80,0x80, // -f-
        0x00,0x0F,0x10,0x10,0x08,0x1F,0x00,0x00,0xA0,0xA0,0xA0,0xC0, // -g-
        0x40,0x7F,0x08,0x10,0x10,0x0F,0x80,0x80,0x80,0x00,0x80,0x80, // -h-
        0x00,0x10,0x10,0x5F,0x00,0x00,0x00,0x80,0x80,0x80,0x80,0x80, // -i-
        0x00,0x10,0x10,0x50,0x1F,0x00,0x00,0x20,0x20,0x20,0xC0,0x00, // -j-
        0x40,0x7F,0x04,0x16,0x19,0x10,0x80,0x80,0x00,0x80,0x80,0x80, // -k-
        0x00,0x00,0x40,0x7F,0x00,0x00,0x00,0x80,0x80,0x80,0x80,0x80, // -l-
        0x10,0x1F,0x10,0x0F,0x10,0x0F,0x80,0x80,0x80,0x80,0x80,0x80, // -m-
        0x10,0x1F,0x08,0x10,0x10,0x0F,0x80,0x80,0x80,0x00,0x80,0x80, // -n-
        0x00,0x0F,0x10,0x10,0x10,0x0F,0x00,0x00,0x80,0x80,0x80,0x00, // -o-
        0x10,0x1F,0x08,0x10,0x10,0x0F,0x20,0xE0,0xA0,0x80,0x80,0x00, // -p-
        0x00,0x0F,0x10,0x10,0x08,0x1F,0x00,0x00,0x80,0x80,0xA0,0xE0, // -q-
        0x00,0x10,0x1F,0x08,0x10,0x10,0x00,0x80,0x80,0x80,0x80,0x80, // -r-
        0x00,0x09,0x14,0x14,0x14,0x1B,0x00,0x80,0x80,0x80,0x80,0x00, // -s-
        0x00,0x10,0x3F,0x10,0x10,0x10,0x00,0x00,0x00,0x80,0x80,0x80, // -t-
        0x10,0x1F,0x00,0x00,0x11,0x1F,0x00,0x00,0x80,0x80,0x00,0x80, // -u-
        0x10,0x1C,0x13,0x00,0x13,0x1C,0x00,0x00,0x00,0x80,0x00,0x00, // -v-
        0x10,0x1F,0x10,0x07,0x10,0x1F,0x00,0x00,0x80,0x00,0x80,0x00, // -w-
        0x10,0x19,0x06,0x06,0x19,0x10,0x80,0x80,0x00,0x00,0x80,0x80, // -x-
        0x10,0x18,0x16,0x01,0x13,0x1C,0x00,0x20,0x20,0xE0,0x20,0x00, // -y-
        0x00,0x19,0x12,0x14,0x18,0x11,0x00,0x80,0x80,0x80,0x80,0x80, // -z-
        0x00,0x00,0x02,0x3D,0x40,0x00,0x00,0x00,0x00,0xC0,0x20,0x00, // -{-
        0x00,0x00,0x00,0x7F,0x00,0x00,0x00,0x00,0x00,0xC0,0x00,0x00, // -|-
        0x00,0x00,0x40,0x3D,0x02,0x00,0x00,0x00,0x20,0xC0,0x00,0x00, // -}-
        0x00,0x02,0x04,0x02,0x02,0x04,0x00,0x00,0x00,0x00,0x00,0x00, // -~-
        0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00, // --
}; 
idata char *q=lv;

//========================================================
/*void LCD_CheckBusy(void)
{
   //DataPort=0xff;
	LCD_IO_DATA=0xff;
   RS=0;  
   //_nop_();
   RW=1; 
   _nop_();
   EN=1;
   _nop_();
   _nop_();
   //while(DataPort&Busy);
	DDRC=0x00;
	while(PINC&Busy);
   EN=0;
}*/
//========================================================
/*void LCD_Enable(void)
{
   EN=1;
   _nop_();_nop_();_nop_();
   _nop_();
   EN=0;
}*/
//========================================================
//void LCD_WriteCommand(void)
/*void sendorder(void)
{     
   //LCD_CheckBusy();
   RS=0; _nop_();_nop_();_nop_();_nop_();
   //_nop_();
   RW=0;     
   _nop_();_nop_();_nop_();
   //DataPort=Command;
   _nop_();
   LCD_Enable();
   //RW=1;   
   //_nop_();
   //RS=0;  
   //_nop_();
}*/
//========================================================
//void LCD_WriteData(void)
/*void senddata(void)
{
   //LCD_CheckBusy();
   RS=1;  
   //_nop_();
   RW=0;     
   _nop_();
   //DataPort=Data;
   _nop_();
   LCD_Enable();
   //RW=1;
   //_nop_();
   //RS=0; 
   //_nop_();
}*/
//========================================================
//========================================================
//初始化LCD
//========================================================
void InitGraphic(void)
{
		//========================================================
		LCD_IO_DATA =0x00;                  //端口初始化
		LCD_IO_CONTROL =0x8f;
		//========================================================
		
		LCD_IO_CONTROL &= ~C_RST_Pin;
		LCD_IO_CONTROL |= C_RST_Pin;
		
		//========================================================
		LCD_IO_DATA =0xaf;	//LCD_ON								  
		sendorder();
		LCD_IO_DATA =0x2f;	//上电模式
		sendorder();
		LCD_IO_DATA =0x81;	//电量设置模式(屏幕亮度)
		sendorder();
		LCD_IO_DATA =0x30;	//指令数据
		sendorder();
		LCD_IO_DATA =0x27;	//内部电压调节电阻设置
		sendorder();
		LCD_IO_DATA =0xa3;	//偏压设置
		sendorder();
		LCD_IO_DATA =0xc0;	//Com 扫描方式设置(0xc8反向)
		sendorder();
		//LCD_IO_DATA =0xa1;
		LCD_IO_DATA =0xa0;  //Segment方向选择(0xa1反向)
		sendorder();
		LCD_IO_DATA =0xa4;  //全屏变亮(0xa5变亮)
		sendorder();
		LCD_IO_DATA =0xa6;  //正相反相显示控制指令，RAM中数据不变(0xa7)
		sendorder();
		LCD_IO_DATA =0xac;  //静态指示器控制指令(0xad为on)
		sendorder();
		LCD_IO_DATA =0x00;  
		sendorder();
		LCD_IO_DATA =0x40;  //设置显示起始行对应RAM行号
		sendorder();
		//setpage(0);
		//setaddr(0);
		ClearScreen(0);
}

 /*LCD_IO_DATA =0xe2;                  //复位 reset
 sendorder();                              //送命令子函数
 LCD_IO_DATA =0xe3;                  //空操作 
 sendorder();
 LCD_IO_DATA =0xc0;                  //COM口扫描方向63---0
  sendorder();
 LCD_IO_DATA =0xa0;                  //ADC(segment方向)设定为正常  A1  reverse
  sendorder();
 //电源设定
 //========================================================
 LCD_IO_DATA =0xa2;                  // LCD偏压设定 1/9 bias
  sendorder();
 LCD_IO_DATA =0x24;                  //V5电压内部电阻调整设置 
  sendorder();
 LCD_IO_DATA =0x81;                  //电量设置模式 （双字节）
  sendorder();                                
 LCD_IO_DATA =0x1a;                  //调整显示屏亮度
  sendorder();
 LCD_IO_DATA =0xd2;                  //驱动模式
  sendorder();
 LCD_IO_DATA =0x00;                  //模式2
 sendorder();
 LCD_IO_DATA =0x2c;                  //上电控制设置   REGULATOR on
 sendorder();
 LCD_IO_DATA =0x2e; //while(1)              //上电控制设置   +FOLLOWER oFF  ????（或许是）
 sendorder();
 LCD_IO_DATA =0x2f;                 //上电控制设置   +FOLLOWER on   ????（或许是）
 sendorder();                              //power set  over
  //========================================================
 LCD_IO_DATA =0xaf;                  //开显示
 sendorder();
 setpage(0);                                //页设置为第0页 
 LCD_IO_DATA =0x40;                  //显示起始行设置为第0行 
 sendorder();
 setaddr(0);                                //列设置为第0列

 LCD_IO_DATA =0xa5;                  //全屏点亮
 
 sendorder();
 LCD_IO_DATA =0xa4;                  //正常显示
 sendorder(); 
 ClearScreen(0);                           //清屏全部ROM填零
}*/                               
//========================================================
//初始化LCD结束

//发送命令子函数
//========================================================
void sendorder(void)
{
		idata char c;
		c=(C_AOP_Pin|C_EP_Pin|C_RWP_Pin);
		c^=0xff;
		LCD_IO_CONTROL=c;
		delay();
		LCD_IO_CONTROL=c|C_EP_Pin;
		delay();
		LCD_IO_CONTROL=c;		 
		delay();
}
//========================================================
//写入数据子函数
//========================================================
void senddata(void)
{
		idata char c;
		c=(C_AOP_Pin|C_EP_Pin|C_RWP_Pin);
		c^=0xff;
		LCD_IO_CONTROL=c;
		delay();
		LCD_IO_CONTROL=c|C_AOP_Pin|C_EP_Pin;
		delay();
		LCD_IO_CONTROL=c;
		delay();
}
//========================================================
//页设置子函数
//========================================================
void setpage( int a)
{
		a|=0xb0;; //a|=0xb0;
		LCD_IO_DATA =a;
		sendorder();
}
//========================================================
//列设置子函数
//========================================================
void setaddr( int addr)
{
		idata int b;
		b=addr>>4;
		b&=0x1f;
		b|=0x10;
		addr&=0x0f;
		LCD_IO_DATA =addr;
		sendorder();
		LCD_IO_DATA =b;
		sendorder();
 }
//========================================================
//清屏子函数     fill ROM with 0 or 1
//========================================================
void ClearScreen( int a)
{
		idata int z1,z2;
		if(a!=0) a=0xff;
		for(z1=0;z1<8;z1++)
		{
				setpage(z1);
				setaddr(0);
				for(z2=0;z2<128;z2++)
				{
				LCD_IO_DATA =a;
				senddata();
				}
		}
}





//========================================================
//显示汉字
//========================================================
void putstring(char a,char b,char *n)   //汉字
{
		idata char i,*p;
		printu(n);
		while(*n!=0)
		{
		
				p=q+12*(*n-32);
				setpage(a+1);
				setaddr(b);
				for(i=0;i<6;i++)
				{x(*p);
				p++;}
				setpage(a);
				setaddr(b);
				for(i=6;i<12;i++)
				{x(*p);
				p++;}
				
				
				b = b+7;
				if((b + 7) > 127)
				{
				b = 0;
				if(a < 2 ) break;
				else a -= 2;
				}
				
				n++;
		}

}

void x(char n)
{
		LCD_IO_DATA =n;
		senddata();
}

main2()
{
	idata int i;
	InitGraphic();//putchar(0,62,0);
	//while(1)
	for(i=0;i<100;i++)
	{
		putstring(6,0, "Welcome to http://shop34480016.taobao.com  www.dianshijin.cn");
	}
}

