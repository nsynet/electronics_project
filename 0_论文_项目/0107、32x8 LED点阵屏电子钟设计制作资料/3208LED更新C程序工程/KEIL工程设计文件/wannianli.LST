C51 COMPILER V7.50   WANNIANLI                                                             12/20/2005 21:39:34 PAGE 1   


C51 COMPILER V7.50, COMPILATION OF MODULE WANNIANLI
OBJECT MODULE PLACED IN wannianli.OBJ
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE wannianli.c BROWSE DEBUG OBJECTEXTEND

line level    source

   1          /*-------------------------------------------
   2          ÏîÄ¿Ãû£º¡¡¡¡¡¡2006Äê±ÏÒµÉè¼ÆÏîÄ¿
   3          ³ÌÐòÃû£º ¡¡¡¡ 32*8µãÕóÆÁµç×ÓÖÓ
   4          ±àÐ´ÈË£º ¡¡¡¡ ¶ÅÑó¡¡
   5          ³õÐ´Ê±¼ä£º¡¡¡¡2005-12-15~2005-12-¡¡¡¡
   6          CPUËµÃ÷£º¡¡¡¡ MCS-51£¨AT89S52£©¡¡12MHZ
   7          ½Ó¿ÚËµÃ÷£º¡¡¡¡DS1302¡¢DS18B20
   8          ÐÞ¸ÄÈÕÖ¾£º¡¡¡¡
   9          ¡¡¡¡NO.1-20051215¡¡Íê³ÉLEDÇý¶¯¡¢ÏÔÊ¾ÇÐ»»¡¢Ê±ÖÓÎÂ¶È¶ÁÈ¡
  10                  NO.2-20051216¡¡Íê³ÉÕûµã±¨Ê±¡¢Ìî¼Ó×¢ÊÍÐÅÏ¢
  11          ¡¡      NO.3-20051220¡¡Íê³ÉÁËµ÷Ê±¡¢°´¼üÒôµÈËùÒÔµÄ¹¦ÄÜ£¨Ã»ÓÐÄÖÖÓ£©
  12          -------------------------------------------*/
  13          
  14          //------------------------------¶¨ÒåÍ·ÎÄ¼þ
  15          #include <reg51.h>//MCS-51µ¥Æ¬»ú
  16          //------------------------------¶¨ÒåËõÐ´×Ö·û
  17          #define  uchar unsigned char
  18          #define  uint  unsigned int
  19          //------------------------------¶¨ÒåÑïÉùÆ÷½Ó¿Ú£¬µÍµçÆ½Ê¹ÄÜ
  20          sbit Bell_Out  = P1 ^ 5;//ÑïÉùÆ÷Çý¶¯
  21          //------------------------------¶¨ÒåDS18B20Òô
  22          sbit DQ        = P1 ^ 6;//ds1820data£¨µ¥×ÜÏß£©
  23          //------------------------------¶¨ÒåDS1302Ê±ÖÓ½Ó¿Ú
  24          sbit clock_clk = P3 ^ 5;//ds1302_clk£¨Ê±ÖÓÏß£©
  25          sbit clock_dat = P3 ^ 6;//ds1302_dat£¨Êý¾ÝÏß£©
  26          sbit clock_Rst = P3 ^ 7;//ds1302_Rst£¨¸´Î»Ïß£©
  27          //-----------------------------¶¨ÒåÊý¾Ý¿Ú
  28          #define Led_13     P0  //µÚ1¡¢3ÆÁÊý¾Ý¿Ú
  29          #define Led_24     P2  //µÚ2¡¢4ÆÁÊý¾Ý¿Ú
  30          #define Led_E      P1  //74HC154µÄBCDÁÐÇý¶¯£¨P1.0~P1.4£©
  31          sbit Led_EA    =   P1 ^ 4;//ÏÔÊ¾ÁÐÇý¶¯Æ÷£¨74HC154£©Ê¹ÄÜ
  32          //-----------------------------¶ÀÁ¢¼üÅÌ¶¨Òå
  33          sbit Add_Key   = P3 ^ 1;//Ç°Î»¼Ó1¼ü
  34          sbit Add2_Key  = P3 ^ 0;//ºóÎ»¼Ó1¼ü
  35          sbit OK_Key    = P3 ^ 2;//È·¶¨¼ü
  36          sbit int_Key   = P3 ^ 3;//ÖÐ¶ÏÈë¿Ú
  37          //-----------------------------¶¨ÒåÀÛ¼ÓÆ÷AÖÐµÄ¸÷Î»
  38          sbit a0   = ACC ^ 0;
  39          sbit a1   = ACC ^ 1;
  40          sbit a2   = ACC ^ 2;
  41          sbit a3   = ACC ^ 3;
  42          sbit a4   = ACC ^ 4;
  43          sbit a5   = ACC ^ 5;
  44          sbit a6   = ACC ^ 6;
  45          sbit a7   = ACC ^ 7;
  46          //------------------------------------¶¨ÒåÈ«¾Ö±äÁ¿
  47          bit txx = 0,settime = 0;//¶¨Òå±êÖ¾Î»
  48          uchar yy,mo,dd,xq,hh,mm,bn;//¶¨ÒåÊ±¼äÓ³ÉäÈ«¾Ö±äÁ¿£¨×¨ÓÃ¼Ä´æÆ÷£©
  49          static uchar timecount = 0;//¶¨Òå¾²Ì¬Èí¼þ¼ÆÊýÆ÷±äÁ¿
  50          //------------------------------------º¯ÊýÉùÃ÷(°´×ÖÄ¸Ë³ÐòÅÅÁÐ£© 
  51          void Beep(void);
  52          void Beep_key(void);
  53          void Beep_set(void);
  54          void clearRAM (void);
  55          uchar clock_in(void);
C51 COMPILER V7.50   WANNIANLI                                                             12/20/2005 21:39:34 PAGE 2   

  56          void clock_out(uchar dd);
  57          void Delay(int num);
  58          void DelayM(uint a);
  59          void display (void);
  60          void display_s (void);
  61          void Init_1302(void);
  62          void int1 (void);
  63          void putin (uchar u);
  64          uchar read_clock(uchar ord);
  65          void read_clockS(void);
  66          void Set_time(unsigned char sel);
  67          void setput (uchar k);
  68          void Timer0(void);
  69          void Timer0_Init(void);
  70          void write_clock(uchar ord, uchar dd);
  71          uchar DL (uchar);
  72          uchar DSS (void);
  73          
  74          //-----------------------------¶¨ÒåÏÔÊ¾»º³å¼Ä´æÆ÷£¨32¸ö×Ö½ÚÈ«¾Ö±äÁ¿£©
  75          uchar Ledplay [35];//
  76          //-----------------------------¶¨Òå×Ö·ûÊý¾Ý±íµ¥£¨¶þÎ¬Êý×é£©
  77          uchar code no[][10]={
  78          //-----------------------------------Êý×Ö×Ö·û±í 
  79          {0x7E,0xFF,0x81,0x81,0xFF,0x7E,0},//0
  80          {0x82,0xFF,0xFF,0x80,0}, //1
  81          {0xC6,0xE7,0xB1,0x99,0x8F,0x86,0},//2
  82          {0x42,0xC3,0x89,0x89,0xFF,0x76,0},//3
  83          {0x30,0x28,0xA6,0xFF,0xFF,0xA0,0},//4
  84          {0x4F,0xCF,0x89,0x89,0xF9,0x71,0},//5
  85          {0x7E,0xFF,0x89,0x8B,0xFB,0x70,0},//6
  86          {0x03,0x03,0xF9,0xFF,0x07,0},//7
  87          {0x76,0xFF,0x89,0x89,0xFF,0x76,0},//8
  88          {0x0E,0xDF,0xD1,0x91,0xFF,0x7E,0},//9
  89          //-----------------------------------ÐÇÆÚ×Ö·û±í
  90          {0x10,0x10,0x10,0x10,0x10,0x10,0x18,0x10,0},//Ò»10
  91          {0x40,0x44,0x44,0x44,0x44,0x44,0x44,0x40,0},//¶þ
  92          {0x82,0x92,0x92,0x92,0x92,0x92,0x82,0x80,0},//Èý
  93          {0xFE,0xA2,0x9E,0x82,0x9E,0xA2,0xFE,0},//ËÄ
  94          {0x80,0x89,0xFF,0x89,0x89,0x89,0xF9,0x80,0},//Îå
  95          {0x88,0x68,0x38,0x0E,0x38,0x68,0x88,0},//Áù
  96          {0xFE,0x92,0x92,0x92,0x92,0xFE,0},//ÈÕ                  10+6
  97          //-----------------------------------ÌØÊâ×Ö·û±í
  98          {0x6C,0x6C,0},//¡°:¡±                                                           17
  99          {0x18,0x18,0x18,0x18,0},//¡°-¡±                                           18
 100          {0x06,0x06,0x78,0xFC,0x84,0x84,0x84,0x80,0},//¡°oC¡±    19
 101          {0x02,0x8E,0xFC,0xFC,0x8E,0x02,0}//¡°Y¡±£¨ÔÚµ÷Ê±Ê±±íÊ¾Äê£©
 102          };
 103          //-----------------------------------¿ª»ú»­Ãæ£¬ÏÔÊ¾¡°DYDIY¡±
 104          uchar code dydiy[]={//ÏÔÊ¾¡°DYDIY¡±
 105          0x82,0xFE,0xFE,0x82,0xFE,0x7C,0,
 106          0x02,0x8E,0xFC,0xFC,0x8E,0x02,0,
 107          0x82,0xFE,0xFE,0x82,0xFE,0x7C,0,
 108          0x82,0xFE,0xFE,0x82,0,
 109          0x02,0x8E,0xFC,0xFC,0x8E,0x02,0,0x99
 110          }; 
 111          //---------------------------------------ÑÓÊ±º¯Êý 2uS/´Î
 112          void Delay(int num){
 113   1              for (;num>0;num--);
 114   1      }
 115          //---------------------------------------ÑÓÊ±º¯Êý 1MS/´Î
 116          void DelayM(unsigned int a){    
 117   1                      unsigned char i;
C51 COMPILER V7.50   WANNIANLI                                                             12/20/2005 21:39:34 PAGE 3   

 118   1                      while( --a != 0){               
 119   2                              for(i = 0; i < 125; i++);  //Ò»¸ö ; ±íÊ¾¿ÕÓï¾ä,CPU¿Õ×ª¡£
 120   2                      }                                  //i ´Ó0¼Óµ½125£¬CPU´ó¸Å¾ÍºÄÊ±1ºÁÃë
 121   1              }
 122          //---------------------------------------1302Çý¶¯³ÌÐò£¨µ×²ãÐ­Òé£©
 123          void clock_out(unsigned char dd){
 124   1              ACC=dd;
 125   1              clock_dat=a0; clock_clk=1; clock_clk=0;
 126   1              clock_dat=a1; clock_clk=1; clock_clk=0;
 127   1              clock_dat=a2; clock_clk=1; clock_clk=0;
 128   1              clock_dat=a3; clock_clk=1; clock_clk=0;
 129   1              clock_dat=a4; clock_clk=1; clock_clk=0;
 130   1              clock_dat=a5; clock_clk=1; clock_clk=0;
 131   1              clock_dat=a6; clock_clk=1; clock_clk=0;
 132   1              clock_dat=a7; clock_clk=1; clock_clk=0;
 133   1      }
 134          //---------------------------------------DS1302Ð´Èë×Ö½Ú£¨µ×²ãÐ­Òé£©
 135          unsigned char clock_in(void){
 136   1              clock_dat=1;
 137   1              a0=clock_dat;
 138   1              clock_clk=1; clock_clk=0; a1=clock_dat;
 139   1              clock_clk=1; clock_clk=0; a2=clock_dat;
 140   1              clock_clk=1; clock_clk=0; a3=clock_dat;
 141   1              clock_clk=1; clock_clk=0; a4=clock_dat;
 142   1              clock_clk=1; clock_clk=0; a5=clock_dat;
 143   1              clock_clk=1; clock_clk=0; a6=clock_dat;
 144   1              clock_clk=1; clock_clk=0; a7=clock_dat;
 145   1              return(ACC);
 146   1      }
 147          //----------------------------------------DS1302¶ÁÊý¾Ý£¨µ×²ãÐ­Òé£©
 148          uchar read_clock(uchar ord){
 149   1              uchar dd=0;
 150   1              clock_clk=0;
 151   1              clock_Rst=0;
 152   1              clock_Rst=1;
 153   1              clock_out(ord);
 154   1              dd=clock_in();
 155   1              clock_Rst=0;
 156   1              clock_clk=1;
 157   1              return(dd);
 158   1      }
 159          //---------------------------------------³£ÓÃÊ±ÖÓÊý¾Ý¶ÁÈ¡
 160          void read_clockS(void){
 161   1              mm = read_clock(0x83);//¶ÁÈ¡·ÖÖÓÊý¾Ý
 162   1              hh = read_clock(0x85);//Ð¡Ê±
 163   1              dd = read_clock(0x87);//ÈÕ
 164   1              mo = read_clock(0x89);//ÔÂ
 165   1              xq = read_clock(0x8b);//ÐÇÆÚ
 166   1              yy = read_clock(0x8d);//Äê
 167   1      }
 168          //*---------------------------------------DS1302Ð´Êý¾Ý£¨µ×²ãÐ­Òé£©
 169          void write_clock(uchar ord, uchar dd){
 170   1              clock_clk=0;
 171   1              clock_Rst=0;
 172   1              clock_Rst=1;
 173   1              clock_out(ord);
 174   1              clock_out(dd);
 175   1              clock_Rst=0;
 176   1              clock_clk=1;
 177   1      }
 178          //--------------------------------------------------µ÷Ê±ÓÃ¼Ó1³ÌÐò
 179          void Set_time(unsigned char sel){ //¸ù¾ÝÑ¡Ôñµ÷ÕûµÄÏàÓ¦ÏîÄ¿¼Ó1²¢Ð´ÈëDS1302
C51 COMPILER V7.50   WANNIANLI                                                             12/20/2005 21:39:34 PAGE 4   

 180   1        signed char address,item;
 181   1        signed char max,mini;
 182   1        if(sel==7)  {address=0x80; max=0;mini=0;}     //Ãë7
 183   1        if(sel==6)  {address=0x82; max=59;mini=0;}    //·ÖÖÓ6
 184   1        if(sel==5)  {address=0x84; max=23;mini=0;}    //Ð¡Ê±5
 185   1        if(sel==3)  {address=0x86; max=31;mini=1;}    //ÈÕ3
 186   1        if(sel==2)  {address=0x88; max=12;mini=1;}    //ÔÂ2
 187   1        if(sel==1)  {address=0x8c; max=99; mini=0;}    //Äê1
 188   1        if(sel==4)  {address=0x8a; max=7;mini=1;}    //ÐÇÆÚ4  
 189   1        //¶ÁÈ¡1302Ä³µØÖ·ÉÏµÄÊýÖµ×ª»»³É10½øÖÆ¸³¸øitem 
 190   1        item=((read_clock(address+1))/16)*10 + (read_clock(address+1))%16;
 191   1              item++;//ÊýÖµ¼Ó1  
 192   1        if(item>max) item=mini;//²é¿´ÊýÖµÓÐÐ§·¶Î§   
 193   1        if(item<mini) item=max;           
 194   1        write_clock(0x8e,0x00);//ÔÊÐíÐ´²Ù×÷
 195   1        write_clock(address,(item/10)*16+item%10);//×ª»»³É16½øÖÆÐ´Èë1302
 196   1        write_clock(0x8e,0x80);//Ð´±£»¤£¬½ûÖ¹Ð´²Ù×÷  
 197   1      }
 198          //--------------------------------------------ÉèÖÃ1302µÄ³õÊ¼Ê±¼ä
 199          void Init_1302(void){//£¨2005Äê12ÔÂ20ÈÕ12Ê±00·Ö00ÃëÐÇÆÚ¶þ£©
 200   1              write_clock(0x8e,0x00);//ÔÊÐíÐ´²Ù×÷
 201   1              write_clock(0x8c,0x05);//Äê
 202   1              write_clock(0x8a,0x02);//ÐÇÆÚ
 203   1              write_clock(0x88,0x12);//ÔÂ
 204   1              write_clock(0x86,0x20);//ÈÕ
 205   1              write_clock(0x84,0x12);//Ð¡Ê±
 206   1              write_clock(0x82,0x00);//·ÖÖÓ
 207   1              write_clock(0x80,0x00);//Ãë
 208   1              write_clock(0x90,0xa5);//³äµç   
 209   1              write_clock(0x8e,0x80);//½ûÖ¹Ð´²Ù×÷
 210   1      }
 211          //--------------------------------------------ÑïÉùÆ÷--Õûµã±¨Ê±
 212          void Beep(void){//BELL 
 213   1              uchar a;//¶¨Òå±äÁ¿ÓÃÓÚ·¢ÉùµÄ³¤¶ÈÉèÖÃ
 214   1              Led_EA = 1;//¹ØÁÐÏÔÊ¾Çý¶¯£¬·ÀÖ¹ÆÁÄ»³öÏÖÂÒÂë
 215   1              for(a=60;a>0;a--){//µÚÒ»¸öÉùÒôµÄ³¤¶È
 216   2                      Bell_Out = ~Bell_Out;//È¡·´ÑïÉùÆ÷Çý¶¯¿Ú£¬ÒÔ²úÉúÒôÆµ
 217   2                      Delay(100);//Òôµ÷ÉèÖÃÑÓÊ±
 218   2              }
 219   1              for(a=100;a>0;a--){//Í¬ÉÏ
 220   2                      Bell_Out = ~Bell_Out;
 221   2                      Delay(80);//
 222   2              }
 223   1              for(a=100;a>0;a--){//Í¬ÉÏ
 224   2                      Bell_Out = ~Bell_Out;
 225   2                      Delay(30);//
 226   2              }
 227   1      }
 228          //--------------------------------------------ÑïÉùÆ÷--ÉèÖÃ±¨¾¯
 229          void Beep_set(void){//BELL 
 230   1              uchar a;//¶¨Òå±äÁ¿ÓÃÓÚ·¢ÉùµÄ³¤¶ÈÉèÖÃ
 231   1              Led_EA = 1;//¹ØÁÐÏÔÊ¾Çý¶¯£¬·ÀÖ¹ÆÁÄ»³öÏÖÂÒÂë
 232   1              for(a=250;a>0;a--){//µÚÒ»¸öÉùÒôµÄ³¤¶È
 233   2                      Bell_Out = ~Bell_Out;//È¡·´ÑïÉùÆ÷Çý¶¯¿Ú£¬ÒÔ²úÉúÒôÆµ
 234   2                      Delay(20);//Òôµ÷ÉèÖÃÑÓÊ±
 235   2              }
 236   1              for(a=100;a>0;a--){//Í¬ÉÏ
 237   2                      Bell_Out = ~Bell_Out;
 238   2                      Delay(80);//
 239   2              }
 240   1      }       
 241          //----------------------------------------ÑïÉùÆ÷--°´¼üÒô
C51 COMPILER V7.50   WANNIANLI                                                             12/20/2005 21:39:34 PAGE 5   

 242          void Beep_key(void){
 243   1              uchar a;//¶¨Òå±äÁ¿ÓÃÓÚ·¢ÉùµÄ³¤¶ÈÉèÖÃ
 244   1              Led_EA = 1;//¹ØÁÐÏÔÊ¾Çý¶¯£¬·ÀÖ¹ÆÁÄ»³öÏÖÂÒÂë
 245   1              for(a=100;a>0;a--){//ÉùÒôµÄ³¤¶È
 246   2                      Bell_Out = ~Bell_Out;
 247   2                      Delay(50);//Òôµ÷ÉèÖÃÑÓÊ±
 248   2              }
 249   1      }
 250          //----------------------------------------32¸ö¼Ä´æÆ÷Çå¿Õ£¨0x00£©
 251          void clearRAM (void){//¼Ä´æÆ÷Çå¿Õº¯Êý
 252   1              uchar a;//¶¨Òå±äÁ¿ÓÃÓÚÇå¿ÕÊý¾ÝÖ¸Õë
 253   1              for(a=0;a<32;a++){//Ö¸Ïò32¸ö¼Ä´æÆ÷
 254   2                      Ledplay[a] = 0;//½«Ö¸ÏòµÄ¼Ä´æÆ÷Çå¿Õ
 255   2              }
 256   1      }
 257          //----------------------------------------½«×Ö·û×°ÈëÏÔÊ¾¼Ä´æÆ÷
 258          void putin (uchar u){//×Ö·ûÔØÈëº¯Êý
 259   1              uchar a = 0;//¶¨Òå±äÁ¿ÓÃÓÚÊý¾ÝÌáÈ¡Ö¸Õë
 260   1              do{             
 261   2                      Ledplay[bn] = no[u][a];//½«¶þÎ¬Êý×éÖÐµÄÒ»×éÊý¾Ý·ÅÈëÏÔÊ¾»º³åÇø
 262   2                      a++;//»»ÏÂÒ»¸öÌáÈ¡×Ö½Ú  
 263   2                      bn++;//»»ÏÂÒ»¸öÏÔÊ¾»º³å×Ö½Ú                     
 264   2              }
 265   1              while(no[u][a] != 0);//µ±ÏÔÊ¾Êý¾ÝÎª0Ê±½áÊøÑ­»·
 266   1              bn++;//»»ÏÂÒ»¸öÏÔÊ¾»º³å×Ö½Ú
 267   1              Ledplay[bn] = 0;//ÏÔÊ¾Ò»ÁÐµÄ¿ÕÎ»£¬±ãÓÚ×Ö·ûÇø·Ö  
 268   1      }
 269          //------------------------------------µ÷Ê±ÇÐ»»
 270          void setput (uchar k){
 271   1              switch(k){//KÎª0µ÷ÕûÈÕÆÚ£¬KÎª1µ÷ÕûÊ±¼ä£¬KÎª2µ÷ÕûÄêºÍÐÇÆÚ
 272   2                      case 0:{
 273   3                              read_clockS();//µ÷ÓÃÊ±ÖÓÐ¾Æ¬Çý¶¯º¯Êý£¬¶Á³öÊ±ÖÓÊý¾Ý²¢·ÅÈëÏàÓ¦µÄ¼Ä´æÆ÷
 274   3                              clearRAM();//Çå¿ÕÏÔÊ¾»º³åÇøÊý¾Ý
 275   3                              bn = 0;//ÏÔÊ¾Î»ÀÛ¼Ó¼Ä´æÆ÷ÇåÁã£¨´ÓÍ·¿ªÊ¼Ð´ÈëÏÔÊ¾»º³åÇø£©
 276   3                              putin(mo/16);//ÏÔÊ¾ÔÂÖµ£¨Ê®Î»£©
 277   3                              putin(mo%16);//ÏÔÊ¾ÔÂÖµ£¨¸öÎ»£©
 278   3                              putin(18);//ÏÔÊ¾ºá¸Ü¡°-¡±
 279   3                              putin(dd/16);//ÏÔÊ¾ÈÕÖµ£¨Ê®Î»£©
 280   3                              putin(dd%16);//ÏÔÊ¾ÈÕÖµ£¨¸öÎ»£©
 281   3                      }break; 
 282   2                      case 1:{
 283   3                              read_clockS();//µ÷ÓÃÊ±ÖÓÐ¾Æ¬Çý¶¯º¯Êý£¬¶Á³öÊ±ÖÓÊý¾Ý²¢·ÅÈëÏàÓ¦µÄ¼Ä´æÆ÷
 284   3                              clearRAM();//Çå¿ÕÏÔÊ¾»º³åÇøÊý¾Ý
 285   3                              bn = 0;//ÏÔÊ¾Î»ÀÛ¼Ó¼Ä´æÆ÷ÇåÁã£¨´ÓÍ·¿ªÊ¼Ð´ÈëÏÔÊ¾»º³åÇø£©
 286   3                              putin(hh/16);//ÏÔÊ¾Ð¡Ê±Öµ£¨Ê®Î»£©
 287   3                              putin(hh%16);//ÏÔÊ¾Ð¡Ê±Öµ£¨¸öÎ»£©
 288   3                              putin(17);//ÏÔÊ¾Ã°ºÅ¡°£º¡±
 289   3                              putin(mm/16);//ÏÔÊ¾·ÖÖÓÖµ£¨Ê®Î»£©
 290   3                              putin(mm%16);//ÏÔÊ¾·ÖÖÓÖµ£¨¸öÎ»£©
 291   3                      }break; 
 292   2                      case 2:{
 293   3                              read_clockS();//µ÷ÓÃÊ±ÖÓÐ¾Æ¬Çý¶¯º¯Êý£¬¶Á³öÊ±ÖÓÊý¾Ý²¢·ÅÈëÏàÓ¦µÄ¼Ä´æÆ÷
 294   3                              clearRAM();//Çå¿ÕÏÔÊ¾»º³åÇøÊý¾Ý
 295   3                              bn = 0;//ÏÔÊ¾Î»ÀÛ¼Ó¼Ä´æÆ÷ÇåÁã£¨´ÓÍ·¿ªÊ¼Ð´ÈëÏÔÊ¾»º³åÇø£©
 296   3                              putin(yy/16);//ÏÔÊ¾Äê£¨Ê®Î»£©
 297   3                              putin(yy%16);//ÏÔÊ¾Äê£¨¸öÎ»£©
 298   3                              putin(20);//ÏÔÊ¾¡°Y¡±±íÊ¾Äê
 299   3                              putin(xq+9);//ÏÔÊ¾ÐÇÆÚÊý¾Ý
 300   3                      }break;
 301   2                      default:{//Êý¾Ý²»¸½Ê±ÍË³ö
 302   3                      }
 303   2              }
C51 COMPILER V7.50   WANNIANLI                                                             12/20/2005 21:39:34 PAGE 6   

 304   1              Beep_key();//°´¼üÒô
 305   1      }
 306          //----------------------------------------32*8µãÕóÏÔÊ¾Çý¶¯
 307          void display (void){//µãÕóÆÁÇý¶¯º¯Êý
 308   1              uchar ac,aa=7;//¶¨ÒåÁ½¸öÊý¾Ý±äÁ¿
 309   1              for(ac=0x28;ac<0x30;ac++){//É¨ÃèºóÁ½¿éLEDÆÁ£¨ÓÉÓÚP1.5½ÓÑïÉùÆ÷ËùÒÔ¸ß4Î»Îª2£¬Ö¼ÔÚ¹ØÉùÒô£©         
 310   2                      Led_E  = ac;//ÓÃacÖµÇý¶¯Ê¹ÄÜÁÐÐÅºÅ              
 311   2                      Led_24 = DL(Ledplay[aa+8]);//½«ÏÔÊ¾¼Ä´æÆ÷Êý¾ÝÐ´Èë2¡¢4ÆÁ£¨Ç¶ÈëDL»ã±àÊÇÎªÁË·­×ª×Ö½ÚÊý¾Ý£¬Èç¹û½ÓÏßÕýÈ·¿ÉÊ¡È
             -¥£©
 312   2                      Led_13 = Ledplay[aa];//½«ÏÔÊ¾¼Ä´æÆ÷Êý¾ÝÐ´Èë1¡¢3ÆÁ
 313   2                      Delay(60);//ÑÓÊ±1.2Î¢Ãë
 314   2                      Led_13 = 0;//Êý¾Ý×ÜÏßÇå¿Õ
 315   2                      Led_24 = 0;
 316   2                      aa--;//aa¼õ1£¬»»ÏÂÒ»ÁÐÏÔÊ¾
 317   2              }
 318   1              aa = 23;//Ö¸¶¨ºó16¸öÊý¾ÝµÄÌáÈ¡  
 319   1              for(ac=0x20;ac<0x28;ac++){//É¨ÃèÇ°Á½¿éLEDÆÁ             
 320   2                      Led_E  = ac;//ÓÃacÖµÇý¶¯Ê¹ÄÜÁÐÐÅºÅ              
 321   2                      Led_24 = DL(Ledplay[aa+8]);//½«ÏÔÊ¾¼Ä´æÆ÷Êý¾ÝÐ´Èë2¡¢4ÆÁ
 322   2                      Led_13 = Ledplay[aa];//½«ÏÔÊ¾¼Ä´æÆ÷Êý¾ÝÐ´Èë1¡¢3ÆÁ                               
 323   2                      Delay(60);//ÑÓÊ±1.2Î¢Ãë
 324   2                      Led_13 = 0;//Êý¾Ý×ÜÏßÇå¿Õ
 325   2                      Led_24 = 0;
 326   2                      aa--;//aa¼õ1£¬»»ÏÂÒ»ÁÐÏÔÊ¾
 327   2              }
 328   1      }
 329          //--------------------------------------------32*8µãÕó·´É«ÏÔÊ¾Çý¶¯£¨±íÊ¾µ÷Ê±£©
 330          void display_s (void){//µãÕóÆÁÇý¶¯º¯Êý
 331   1              uchar ac,aa=7;//¶¨ÒåÁ½¸öÊý¾Ý±äÁ¿
 332   1              for(ac=0x28;ac<0x30;ac++){//É¨ÃèºóÁ½¿éLEDÆÁ£¨ÓÉÓÚP1.5½ÓÑïÉùÆ÷ËùÒÔ¸ß4Î»Îª2£¬Ö¼ÔÚ¹ØÉùÒô£©         
 333   2                      Led_E  = ac;//ÓÃacÖµÇý¶¯Ê¹ÄÜÁÐÐÅºÅ              
 334   2                      Led_24 = ~DL(Ledplay[aa+8]);//½«ÏÔÊ¾¼Ä´æÆ÷Êý¾Ý·´É«Ð´Èë2¡¢4ÆÁ£¨Ç¶ÈëDL»ã±àÊÇÎªÁË·­×ª×Ö½ÚÊý¾Ý£¬Èç¹û½ÓÏßÕýÈ·
             -¿ÉÊ¡È¥£©
 335   2                      Led_13 = ~Ledplay[aa];//½«ÏÔÊ¾¼Ä´æÆ÷Êý¾Ý·´É«Ð´Èë1¡¢3ÆÁ
 336   2                      Delay(60);//ÑÓÊ±1.2Î¢Ãë
 337   2                      Led_13 = 0;//Êý¾Ý×ÜÏßÇå¿Õ
 338   2                      Led_24 = 0;
 339   2                      aa--;//aa¼õ1£¬»»ÏÂÒ»ÁÐÏÔÊ¾
 340   2              }
 341   1              aa = 23;//Ö¸¶¨ºó16¸öÊý¾ÝµÄÌáÈ¡  
 342   1              for(ac=0x20;ac<0x28;ac++){//É¨ÃèÇ°Á½¿éLEDÆÁ             
 343   2                      Led_E  = ac;//ÓÃacÖµÇý¶¯Ê¹ÄÜÁÐÐÅºÅ              
 344   2                      Led_24 = ~DL(Ledplay[aa+8]);//½«ÏÔÊ¾¼Ä´æÆ÷Êý¾Ý·´É«Ð´Èë2¡¢4ÆÁ
 345   2                      Led_13 = ~Ledplay[aa];//½«ÏÔÊ¾¼Ä´æÆ÷Êý¾Ý·´É«Ð´Èë1¡¢3ÆÁ                          
 346   2                      Delay(60);//ÑÓÊ±1.2Î¢Ãë
 347   2                      Led_13 = 0;//Êý¾Ý×ÜÏßÇå¿Õ
 348   2                      Led_24 = 0;
 349   2                      aa--;//aa¼õ1£¬»»ÏÂÒ»ÁÐÏÔÊ¾
 350   2              }
 351   1      }
 352          //-------------------------------------------------------¶¨Ê±Æ÷0³õÊ¼»¯
 353          void Timer0_Init(void){//¶¨Ê±Æ÷0³õÊ¼£¨Ö÷º¯ÊýÖÐ±»µ÷ÓÃÒ»´Î£©
 354   1              TMOD=0x01;//¶¨Ê±Æ÷·½Ê½ÉèÖÃ£¨¶¨Ê±Æ÷¹¤×÷·½Ê½1-16Î»¶¨Ê±£©
 355   1              TH0=(65535-50000)/256;//50MS
 356   1              TL0=(65535-50000)%256;
 357   1              EA=1;//¿ª×ÜÖÐ¶Ï
 358   1              ET0=1;//¿ª¶¨Ê±Æ÷0ÖÐ¶ÏÔÊÐí 
 359   1              TR0=1;//Æô¶¯¶¨Ê±Æ÷0
 360   1      }
 361          //===============================================¶¨Ê±Æ÷ÖÐ¶Ïº¯Êý£¨²úÉúÏÔÊ¾ÇÐ»»£©
 362          void Timer0(void) interrupt 1 using 0{//¶¨Ê±Æ÷ÖÐ¶ÏÈë¿Ú,Ê¹ÓÃµÚ1¹¤×÷×é¼Ä´æÆ÷      
 363   1              TH0=(65535-50000)/256; //50ms¶¨Ê±£¨¶¨Ê±Æ÷¹¤×÷·½Ê½1£©
C51 COMPILER V7.50   WANNIANLI                                                             12/20/2005 21:39:34 PAGE 7   

 364   1              TL0=(65535-50000)%256;  
 365   1              timecount++;//Èí¼þ¼ÆÊý¼Ó1
 366   1              if(timecount == 20){//Èí¼þ¼ÆÊý¼Óµ½20Ê±ÏÔÊ¾ÈÕÆÚ£¨1S£©
 367   2                      Led_EA  = 1;//¹ØÁÐÏÔÊ¾Çý¶¯£¬·ÀÖ¹ÆÁÄ»³öÏÖÂÒÂë
 368   2                      read_clockS();//µ÷ÓÃÊ±ÖÓÐ¾Æ¬Çý¶¯º¯Êý£¬¶Á³öÊ±ÖÓÊý¾Ý²¢·ÅÈëÏàÓ¦µÄ¼Ä´æÆ÷
 369   2                      clearRAM();//Çå¿ÕÏÔÊ¾»º³åÇøÊý¾Ý
 370   2                      bn = 0;//ÏÔÊ¾Î»ÀÛ¼Ó¼Ä´æÆ÷ÇåÁã£¨´ÓÍ·¿ªÊ¼Ð´ÈëÏÔÊ¾»º³åÇø£©
 371   2                      putin(mo/16);//ÏÔÊ¾ÔÂÖµ£¨Ê®Î»£©
 372   2                      putin(mo%16);//ÏÔÊ¾ÔÂÖµ£¨¸öÎ»£©
 373   2                      putin(18);//ÏÔÊ¾ºá¸Ü¡°-¡±
 374   2                      putin(dd/16);//ÏÔÊ¾ÈÕÖµ£¨Ê®Î»£©
 375   2                      putin(dd%16);//ÏÔÊ¾ÈÕÖµ£¨¸öÎ»£©                                 
 376   2              }
 377   1              if(timecount == 40){//Èí¼þ¼ÆÊý¼Óµ½40Ê±ÏÔÊ¾Ê±¼ä£¨2S£©            
 378   2                      static uchar pp = 0;//¶¨Òå¾²Ì¬Ð¡Ê±¸üÐÂÓÃÊý¾Ý±äÁ¿
 379   2                      Led_EA  = 1;//¹ØÁÐÏÔÊ¾Çý¶¯£¬·ÀÖ¹ÆÁÄ»³öÏÖÂÒÂë             
 380   2                      clearRAM();//Çå¿ÕÏÔÊ¾»º³åÇøÊý¾Ý
 381   2                      bn = 0;//ÏÔÊ¾Î»ÀÛ¼Ó¼Ä´æÆ÷ÇåÁã£¨´ÓÍ·¿ªÊ¼Ð´ÈëÏÔÊ¾»º³åÇø£©
 382   2                      if(hh > 6 && hh < 22){//Õûµã±¨Ê±ÉèÎªÔç6Ê±µ½Íí22Ê±Ö®¼ä
 383   3                              if(pp != hh){//µ±Ð¡Ê±Öµ¸üÐÂÊ±ÔòÆô¶¯±¨Ê±¡¡
 384   4                                      pp = hh;//½«ÐÂµÄÐ¡Ê±Öµ·ÅÈë¸üÐÂ¼Ä´æÆ÷
 385   4                                      Beep();//Æô¶¯±¨Ê±
 386   4                              }                       
 387   3                      } 
 388   2                      putin(hh/16);//ÏÔÊ¾Ð¡Ê±Öµ£¨Ê®Î»£©
 389   2                      putin(hh%16);//ÏÔÊ¾Ð¡Ê±Öµ£¨¸öÎ»£©
 390   2                      putin(17);//ÏÔÊ¾Ã°ºÅ¡°£º¡±
 391   2                      putin(mm/16);//ÏÔÊ¾·ÖÖÓÖµ£¨Ê®Î»£©
 392   2                      putin(mm%16);//ÏÔÊ¾·ÖÖÓÖµ£¨¸öÎ»£©               
 393   2              }
 394   1              if(timecount > 80){////Èí¼þ¼ÆÊý¼Óµ½80Ê±ÏÔÊ¾Ê±¼ä£¨1S£© 
 395   2                      uchar ty = 0;//¶¨ÒåÎÂ¶È¼Ä´æÆ÷±äÁ¿                               
 396   2                      timecount = 0;//Èí¼þ¼ÆÊýÇåÁã
 397   2                      Led_EA  = 1;//¹ØÁÐÏÔÊ¾Çý¶¯£¬·ÀÖ¹ÆÁÄ»³öÏÖÂÒÂë                                                    
 398   2                      ty = DSS();//½«DSS»ã±à³ÌÐòÈ¡µÃµÄÎÂ¶ÈÖµ·ÅÈëÎÂ¶È¼Ä´æÆ÷±äÁ¿
 399   2                              clearRAM();//Çå¿ÕÏÔÊ¾»º³åÇøÊý¾Ý
 400   2                              bn = 0;//ÏÔÊ¾Î»ÀÛ¼Ó¼Ä´æÆ÷ÇåÁã£¨´ÓÍ·¿ªÊ¼Ð´ÈëÏÔÊ¾»º³åÇø£©                 
 401   2                      if(ty >99){//µ±ÎÂ¶È¸ßÓÚ99¶È»òÎ´·¢ÏÖÎÂ¶È´«¸ÐÆ÷£¨DS18B20£©Ê±ÏÔÊ¾¡°--¡±             
 402   3                              putin(18);//ÏÔÊ¾¡°--¡±
 403   3                              putin(18);
 404   3                      }
 405   2                      else{//ÎÂ¶ÈÐ¡ÓÚ99¶È²¢·¢ÏÖÎÂ¶È´«¸ÐÆ÷£¨DS18B20£©Ê±£¬ÏÔÊ¾ÎÂ¶ÈÖµ 
 406   3                              putin(ty/10);//ÎÂ¶ÈÖµµÄÊ®Î»
 407   3                              putin(ty%10);//ÎÂ¶ÈÖµµÄ¸öÎ»
 408   3                      }
 409   2                      putin(19);//ÏÔÊ¾ÉãÊÏ¶È·ûºÅ¡°oC¡±
 410   2                      putin(xq+9);//ÏÔÊ¾ÐÇÆÚÊý¾Ý                                
 411   2          }
 412   1      }
 413          //===============================================ÍâÖÐ¶Ï0£¬µ÷Ê±¿ª¹Ø£¨P3.3£©
 414          void int1 (void) interrupt 2 {//ÖÐ¶ÏÈë¿Ú2£¨INT1£©
 415   1              uchar a;//¶¨ÒåÑÓÊ±³¤¶È
 416   1              for(a=100;a>0;a--){//ÑÓÊ±´¦Àí£¬·ÀÖ¹Îó°´£¨³¤°´2ÃëºóÓÐÐ§£©
 417   2                      display_s ();//·´É«ÏÔÊ¾±íÊ¾°´¼üÓÐÐ§
 418   2              }
 419   1              if(int_Key == 0){//½øÈëÄÖÖÓÉèÖÃ½çÃæ
 420   2                      Beep_set();//µ÷Ê±ÌáÊ¾Òô 
 421   2                      if(settime == 0){//Èç¹ûµ÷Ê±±êÖ¾Îª0ËµÃ÷µ±ÕýÎªÕý³£ÏÔÊ¾×´Ì¬        
 422   3                              ET0 = 0;//¹Ø¶¨Ê±Æ÷ÖÐ¶Ï£¨Í£Ö¹ÏÔÊ¾ÇÐ»»£©
 423   3                              TR0 = 0;
 424   3                              settime = 1;//±äÎªµ÷Ê±µÄ·´É«ÏÔÊ¾                        
 425   3                      }
C51 COMPILER V7.50   WANNIANLI                                                             12/20/2005 21:39:34 PAGE 8   

 426   2                      else{//Èç¹ûµ÷Ê±±êÖ¾Îª1ËµÃ÷µ±ÕýÎªµ÷Ê±ÏÔÊ¾×´Ì¬
 427   3                              ET0 = 1;//¿ª¶¨Ê±Æ÷ÖÐ¶Ï£¨¿ªÆôÏÔÊ¾ÇÐ»»£©
 428   3                              TR0 = 1;
 429   3                              settime = 0;//±äÎªÕý³£ÏÔÊ¾
 430   3                      }
 431   2                      while(int_Key == 0){//µÈ´ýµ÷Ê±¼üÊÍ·Å
 432   3                              display ();//²»ÊÍ·ÅÊ±µ÷ÓÃÆÁÄ»ÏÔÊ¾
 433   3                      }
 434   2              }
 435   1      }
 436          //===============================================Ö÷º¯Êý£¬²úÉúµãÕóÏÔÊ¾
 437          void main(void){ //Ö÷º¯Êý 
 438   1              uchar a = 0;//¶¨Òå±äÁ¿ÓÃÓÚÊý¾ÝÌáÈ¡Ö¸Õë
 439   1              Beep();//Æô¶¯·¢³ö±¨Ê±Òô£¨²âÊÔÑïÉùÆ÷£©
 440   1              do{//ÏÔÊ¾¿ª»ú»­Ãæ¡°DYDIY¡±              
 441   2                      Ledplay[bn] = dydiy[a];//½«¶þÎ¬Êý×éÖÐµÄÒ»×éÊý¾Ý·ÅÈëÏÔÊ¾»º³åÇø
 442   2                      a++;//»»ÏÂÒ»¸öÌáÈ¡×Ö½Ú  
 443   2                      bn++;//»»ÏÂÒ»¸öÏÔÊ¾»º³å×Ö½Ú                     
 444   2              }
 445   1              while(dydiy[a] != 0x99);//µ±ÏÔÊ¾Êý¾ÝÎª0Ê±½áÊøÑ­»·
 446   1              timecount = 41;//½«ÏÔÊ¾ÇÐ»»Öµµ÷µ½41£¬Ê¹¿ª»ú»­ÃæÍ£Áô2Ãë
 447   1              Timer0_Init();//¶¨Ê±Æ÷³õÊ¼»¯
 448   1              IT1 = 0;//ÍâÖÐ¶Ï1ÏÂ³Á´¥·¢
 449   1              EX1 = 1;//¿ªÍâÖÐ¶Ï1£¨µ÷Ê±¼ü£©
 450   1      //-------------------------------------Ö÷Ñ­»·Ìå
 451   1              while(1){//     
 452   2                      static uchar k = 0;
 453   2                      if(settime == 0) {//ÏÔÊ¾±êÖ¾Îª0±íÊ¾Õý³£ÏÔÊ¾
 454   3                              display ();//Õý³£ÏÔÊ¾Çý¶¯
 455   3                              //Õý³£ÏÔÊ¾Ê±Í¬Ê±°´ÏÂAdd¡¢Add2¡¢OKÈý¸ö¼üÔò³õÊ¼»¯Ê±¼ä
 456   3                              if(Add_Key == 0 && Add2_Key ==0 && OK_Key == 0 ){
 457   4                                      DelayM(100);//ÑÓÊ±È¥¶¶¶¯
 458   4                                      if(Add_Key == 0 && Add2_Key ==0 && OK_Key == 0 ){                       
 459   5                                              Beep_set();//ÌáÊ¾Òô
 460   5                                              Init_1302();//µ÷ÓÃÊ±¼ä³õÊ¼»¯º¯Êý
 461   5                                      }
 462   4                              }
 463   3                      }
 464   2                      else{//ÏÔÊ¾±êÖ¾Îª1±íÊ¾µ÷Ê±×´Ì¬                          
 465   3                              display_s();//µ÷Ê±ÏÔÊ¾Çý¶¯
 466   3                              if(OK_Key == 0) {//µ÷Ê±ÇÐ»»¼ü°´ÏÂÇÐ»»µ÷Ê±µÄÄÚÈÝ
 467   4                                      DelayM(20);//È¥¶¶
 468   4                                      if(OK_Key == 0){                                                                        
 469   5                                              k++;//ÇÐ»»ÀÛ¼Ó±äÁ¿                                      
 470   5                                              setput(k);//ÏÔÊ¾ÇÐ»»µÄÄÚÈÝ
 471   5                                          if(k > 2){//ÇÐ»»Öµ³¬³öºóÇå0
 472   6                                                      k = 0;//Çå0
 473   6                                                      setput(0);//ÏÔÊ¾Çå0ºóµÄÄÚÈÝ
 474   6                                              }
 475   5                                      while(OK_Key == 0 );//µÈ´ý¼ü·Å¿ª
 476   5                                      }
 477   4                              }
 478   3                              if(Add_Key == 0){//Ç°Î»¼Ó1¼ü£¨Ê¹ÆÁÄ»Ç°Î»µÄÔÂ£¬Äê£¬Ð¡Ê±¼Ó1£©
 479   4                                      DelayM(20);//È¥¶¶
 480   4                                      if(Add_Key == 0){
 481   5                                              switch(k){//ÒÀÕÕÏÔÊ¾ÄÚÈÝÊý¾Ýµ÷Õû
 482   6                                                      case 0:{
 483   7                                                              Set_time(2);//ÔÂµ÷Õû    
 484   7                                                              setput(k);//¸üÐÂÏÔÊ¾Êý¾Ý
 485   7                                                      }break;
 486   6                                                      case 1:{
 487   7                                                              Set_time(5);//Ð¡Ê±µ÷Õû
C51 COMPILER V7.50   WANNIANLI                                                             12/20/2005 21:39:34 PAGE 9   

 488   7                                                              setput(k);//¸üÐÂÏÔÊ¾Êý¾Ý
 489   7                                                      }break;
 490   6                                                      case 2:{
 491   7                                                              Set_time(1);//Äêµ÷Õû
 492   7                                                              setput(k);//¸üÐÂÏÔÊ¾Êý¾Ý
 493   7                                                      }break;
 494   6                                                      default:{//ÊýÖµ²»¸½µÄ´¦Àí£¨ÎÞ¶¯×÷£©
 495   7                                                      }
 496   6                                              }
 497   5                                      while(Add_Key == 0 );//µÈ´ý¼üÊÍ·Å
 498   5                                      }
 499   4                              }
 500   3                              if(Add2_Key == 0){//ºóÎ»¼Ó1¼ü£¨Ê¹ÆÁÄ»Ç°Î»µÄÈÕ¡¢ÐÇÆÚ¡¢·ÖÖÓ¼Ó1£©
 501   4                                      DelayM(20);
 502   4                                      if(Add2_Key == 0){
 503   5                                              switch(k){
 504   6                                                      case 0:{
 505   7                                                              Set_time(3);//ÈÕµ÷Õû    
 506   7                                                              setput(k);//¸üÐÂÏÔÊ¾Êý¾Ý
 507   7                                                      }break;
 508   6                                                      case 1:{
 509   7                                                              Set_time(6);//·Öµ÷Õû
 510   7                                                              setput(k);//¸üÐÂÏÔÊ¾Êý¾Ý
 511   7                                                      }break;
 512   6                                                      case 2:{
 513   7                                                              Set_time(4);//ÐÇÆÚµ÷Õû
 514   7                                                              setput(k);//¸üÐÂÏÔÊ¾Êý¾Ý
 515   7                                                      }break;
 516   6                                                      default:{//ÊýÖµ²»¸½µÄ´¦Àí£¨ÎÞ¶¯×÷£©
 517   7                                                      }
 518   6                                              }
 519   5                                      while(Add2_Key == 0 );//µÈ´ý¼üÊÍ·Å
 520   5                                      }
 521   4                              }       
 522   3                      }
 523   2              }
 524   1      }
 525          
 526          
 527          
 528          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   1487    ----
   CONSTANT SIZE    =    244    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     45       6
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      2    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
